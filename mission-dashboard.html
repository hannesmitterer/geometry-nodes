<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Ave Maria - Control Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1d3a 100%);
            font-family: 'Courier New', monospace;
        }
        .glass-panel {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(0, 255, 204, 0.3);
            backdrop-filter: blur(10px);
        }
        .status-ok { color: #00ff88; }
        .status-warning { color: #ffaa00; }
        .status-error { color: #ff4444; }
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .grid-bg {
            background-image: 
                linear-gradient(rgba(0, 255, 204, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 204, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
        }
        .metric-card {
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 255, 204, 0.3);
        }
    </style>
</head>
<body class="min-h-screen p-6 grid-bg">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="glass-panel rounded-lg p-6 mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-[#00ffcc] mb-2">Mission Ave Maria</h1>
                    <p class="text-gray-400 text-sm">Peace Bonds Deployment & Monitoring System</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-400">Mission Deadline</div>
                    <div id="deadline-countdown" class="text-2xl font-bold text-[#00ffcc] pulse-animation">
                        Loading...
                    </div>
                </div>
            </div>
        </header>

        <!-- Network Status -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="glass-panel rounded-lg p-6 metric-card">
                <div class="text-sm text-gray-400 mb-2">Primary Network</div>
                <div id="primary-network" class="text-xl font-bold text-white mb-1">Polygon Mumbai</div>
                <div id="network-status" class="text-sm status-ok">● Connected</div>
            </div>
            <div class="glass-panel rounded-lg p-6 metric-card">
                <div class="text-sm text-gray-400 mb-2">Fallback Network</div>
                <div id="fallback-network" class="text-xl font-bold text-white mb-1">zkSync Era Testnet</div>
                <div class="text-sm text-gray-400">● Standby</div>
            </div>
            <div class="glass-panel rounded-lg p-6 metric-card">
                <div class="text-sm text-gray-400 mb-2">Monitoring Status</div>
                <div id="monitoring-status" class="text-xl font-bold status-ok">Active</div>
                <div id="last-update" class="text-sm text-gray-400">Updated: --</div>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="glass-panel rounded-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-[#00ffcc] mb-4">Synchronization Metrics</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div>
                    <div class="text-sm text-gray-400 mb-1">Treasury Balance</div>
                    <div id="treasury-balance" class="text-2xl font-bold text-white">$0.00</div>
                </div>
                <div>
                    <div class="text-sm text-gray-400 mb-1">NSR Frequency</div>
                    <div id="nsr-frequency" class="text-2xl font-bold text-[#00ffcc]">0.043 Hz</div>
                </div>
                <div>
                    <div class="text-sm text-gray-400 mb-1">Drift Index</div>
                    <div id="drift-index" class="text-2xl font-bold text-[#00ff88]">0.000%</div>
                </div>
                <div>
                    <div class="text-sm text-gray-400 mb-1">Active Nodes</div>
                    <div id="active-nodes" class="text-2xl font-bold text-white">144,000</div>
                </div>
            </div>
        </div>

        <!-- Contract Status -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="glass-panel rounded-lg p-6">
                <h2 class="text-xl font-bold text-[#00ffcc] mb-4">Contract Deployments</h2>
                <div id="contracts-list" class="space-y-3">
                    <div class="text-sm text-gray-400">No contracts deployed yet</div>
                </div>
                <button id="deploy-btn" 
                    class="mt-4 w-full bg-[#00ffcc] hover:bg-[#00ddaa] text-black font-bold py-2 px-4 rounded transition">
                    Deploy PeaceBonds Contract
                </button>
            </div>

            <div class="glass-panel rounded-lg p-6">
                <h2 class="text-xl font-bold text-[#00ffcc] mb-4">Mission Validation</h2>
                <div id="validation-checks" class="space-y-2">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-400">Contracts Deployed</span>
                        <span id="check-deployed" class="status-error">✗ Not Ready</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-400">Contracts Verified</span>
                        <span id="check-verified" class="status-error">✗ Not Ready</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-400">Treasury Funded</span>
                        <span id="check-treasury" class="status-ok">✓ Ready</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-400">NSR Stable</span>
                        <span id="check-nsr" class="status-ok">✓ Ready</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-400">Monitoring Active</span>
                        <span id="check-monitoring" class="status-error">✗ Not Active</span>
                    </div>
                </div>
                <button id="validate-btn"
                    class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition">
                    Run Mission Validation
                </button>
            </div>
        </div>

        <!-- Activity Log -->
        <div class="glass-panel rounded-lg p-6">
            <h2 class="text-xl font-bold text-[#00ffcc] mb-4">Activity Log</h2>
            <div id="activity-log" class="space-y-1 max-h-60 overflow-y-auto font-mono text-xs">
                <div class="text-gray-400">[SYSTEM] Dashboard initialized</div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="glass-panel rounded-lg p-6 mt-6">
            <h2 class="text-xl font-bold text-[#00ffcc] mb-4">Control Panel</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button id="start-monitoring-btn"
                    class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition">
                    Start Monitoring
                </button>
                <button id="stop-monitoring-btn"
                    class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition">
                    Stop Monitoring
                </button>
                <button id="switch-network-btn"
                    class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded transition">
                    Switch to Fallback
                </button>
                <button id="test-simulation-btn"
                    class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition">
                    Run Simulation
                </button>
            </div>
        </div>
    </div>

    <!-- Include PeaceBonds Engine -->
    <script src="peacebonds-engine.js"></script>
    
    <script>
        // Initialize PeaceBonds Engine
        let engine = null;
        const MISSION_DEADLINE = new Date('2026-01-10T00:00:00Z').getTime();

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', async () => {
            addLog('Initializing PeaceBonds Engine...', 'info');
            engine = new PeaceBondsEngine();
            
            await engine.initialize('MATIC_TESTNET', 'ZKSYNC_TESTNET');
            addLog('Engine initialized successfully', 'success');
            
            updateUI();
            startDeadlineCountdown();
        });

        // Update countdown timer
        function startDeadlineCountdown() {
            setInterval(() => {
                const now = Date.now();
                const remaining = MISSION_DEADLINE - now;
                
                if (remaining <= 0) {
                    document.getElementById('deadline-countdown').textContent = 'MISSION COMPLETE';
                    document.getElementById('deadline-countdown').classList.remove('pulse-animation');
                    return;
                }

                const days = Math.floor(remaining / (1000 * 60 * 60 * 24));
                const hours = Math.floor((remaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                
                document.getElementById('deadline-countdown').textContent = 
                    `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }, 1000);
        }

        // Update UI with current engine state
        function updateUI() {
            if (!engine) return;

            const metrics = engine.getMetrics();
            const contracts = engine.getContracts();

            // Update metrics
            document.getElementById('treasury-balance').textContent = 
                `$${metrics.treasury.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('nsr-frequency').textContent = `${metrics.nsrFrequency} Hz`;
            document.getElementById('drift-index').textContent = `${metrics.drift.toFixed(3)}%`;
            document.getElementById('active-nodes').textContent = metrics.nodes.toLocaleString();

            // Update network status
            document.getElementById('primary-network').textContent = engine.currentNetwork.name;
            document.getElementById('fallback-network').textContent = engine.fallbackNetwork.name;
            document.getElementById('monitoring-status').textContent = 
                engine.monitoringActive ? 'Active' : 'Inactive';
            document.getElementById('monitoring-status').className = 
                engine.monitoringActive ? 'text-xl font-bold status-ok' : 'text-xl font-bold status-error';

            const now = new Date();
            document.getElementById('last-update').textContent = 
                `Updated: ${now.toLocaleTimeString()}`;

            // Update contracts list
            updateContractsList(contracts);
            
            // Update validation checks
            updateValidationChecks(contracts);
        }

        // Update contracts list
        function updateContractsList(contracts) {
            const listEl = document.getElementById('contracts-list');
            
            if (contracts.length === 0) {
                listEl.innerHTML = '<div class="text-sm text-gray-400">No contracts deployed yet</div>';
                return;
            }

            listEl.innerHTML = contracts.map(contract => `
                <div class="border border-[#00ffcc33] rounded p-3">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-xs text-gray-400">Contract Address</div>
                        <div class="text-xs ${contract.verified ? 'status-ok' : 'status-warning'}">
                            ${contract.verified ? '✓ Verified' : '⚠ Pending'}
                        </div>
                    </div>
                    <div class="text-sm font-mono text-white mb-1">${contract.address}</div>
                    <div class="text-xs text-gray-400">Network: ${contract.network}</div>
                    <div class="text-xs text-gray-400">TX: ${contract.txHash.substring(0, 20)}...</div>
                </div>
            `).join('');
        }

        // Update validation checks
        function updateValidationChecks(contracts) {
            const deployed = contracts.length > 0;
            const verified = contracts.length > 0 && contracts.every(c => c.verified);
            const monitoring = engine.monitoringActive;

            document.getElementById('check-deployed').textContent = 
                deployed ? '✓ Ready' : '✗ Not Ready';
            document.getElementById('check-deployed').className = 
                deployed ? 'status-ok' : 'status-error';

            document.getElementById('check-verified').textContent = 
                verified ? '✓ Ready' : '✗ Not Ready';
            document.getElementById('check-verified').className = 
                verified ? 'status-ok' : 'status-error';

            document.getElementById('check-monitoring').textContent = 
                monitoring ? '✓ Active' : '✗ Not Active';
            document.getElementById('check-monitoring').className = 
                monitoring ? 'status-ok' : 'status-error';
        }

        // Add log entry
        function addLog(message, type = 'info') {
            const logEl = document.getElementById('activity-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'success' ? 'text-green-400' : 
                         type === 'error' ? 'text-red-400' : 
                         type === 'warning' ? 'text-yellow-400' : 'text-gray-400';
            
            const entry = document.createElement('div');
            entry.className = color;
            entry.textContent = `[${timestamp}] ${message}`;
            
            logEl.insertBefore(entry, logEl.firstChild);
            
            // Keep only last 50 entries
            while (logEl.children.length > 50) {
                logEl.removeChild(logEl.lastChild);
            }
        }

        // Event Listeners
        document.getElementById('deploy-btn').addEventListener('click', async () => {
            addLog('Initiating contract deployment...', 'info');
            try {
                const contract = await engine.deployContract();
                addLog(`Contract deployed: ${contract.address}`, 'success');
                updateUI();
            } catch (error) {
                addLog(`Deployment failed: ${error.message}`, 'error');
            }
        });

        document.getElementById('validate-btn').addEventListener('click', async () => {
            addLog('Running mission validation...', 'info');
            const result = await engine.validateMission();
            
            if (result.allChecks) {
                addLog('✅ Mission validation PASSED - All systems ready!', 'success');
            } else {
                addLog('⚠️ Mission validation FAILED - Check requirements', 'warning');
            }
            updateUI();
        });

        let uiUpdateInterval = null;
        
        document.getElementById('start-monitoring-btn').addEventListener('click', () => {
            engine.startMonitoring(3000); // Update every 3 seconds
            addLog('Real-time monitoring started', 'success');
            
            // Set up periodic UI updates (clear any existing interval first)
            if (uiUpdateInterval) {
                clearInterval(uiUpdateInterval);
            }
            uiUpdateInterval = setInterval(() => {
                if (engine.monitoringActive) {
                    updateUI();
                }
            }, 3000);
        });

        document.getElementById('stop-monitoring-btn').addEventListener('click', () => {
            engine.stopMonitoring();
            addLog('Real-time monitoring stopped', 'warning');
            
            // Clear UI update interval
            if (uiUpdateInterval) {
                clearInterval(uiUpdateInterval);
                uiUpdateInterval = null;
            }
            
            updateUI();
        });

        document.getElementById('switch-network-btn').addEventListener('click', async () => {
            addLog('Switching to fallback network...', 'warning');
            await engine.switchToFallback();
            addLog(`Switched to ${engine.currentNetwork.name}`, 'success');
            updateUI();
        });

        document.getElementById('test-simulation-btn').addEventListener('click', async () => {
            addLog('Running system simulation...', 'info');
            
            // Deploy test contract
            await engine.deployContract('TEST_SIMULATION_' + Date.now());
            addLog('Test contract deployed', 'success');
            
            // Start monitoring if not active
            if (!engine.monitoringActive) {
                engine.startMonitoring(3000);
                addLog('Monitoring activated for simulation', 'success');
            }
            
            // Run validation
            setTimeout(async () => {
                const result = await engine.validateMission();
                addLog(`Simulation complete - Status: ${result.allChecks ? 'PASS' : 'FAIL'}`, 
                       result.allChecks ? 'success' : 'warning');
                updateUI();
            }, 2000);
        });
    </script>
</body>
</html>
